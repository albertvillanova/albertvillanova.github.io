<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">sqlite3: SQLite in Python</h1><p class="page-description">Python Standard Library SQL interface</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-10-30T00:00:00-05:00" itemprop="datePublished">
        30 October 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      1 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/tags/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/tags/#sqlite">sqlite</a>
        &nbsp;
      
        <a class="category-tags-link" href="/tags/#sqlite3">sqlite3</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>The Python Standard Library contains a module that provides an SQL interface with the DB-API 2.0 specification: 
<code class="language-plaintext highlighter-rouge">sqlite3</code>. It requires SQLite 3.7.15 or newer.</p>

<p>First, import the <code class="language-plaintext highlighter-rouge">sqlite3</code> module:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>
</code></pre></div></div>

<p>Then, connect to the SQLite database file and create a cursor:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span> <span class="o">=</span> <span class="s">"example.db"</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
</code></pre></div></div>

<p>To get the list of all the tables in the database:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tables</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT name FROM sqlite_schema WHERE type='table'"</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
</code></pre></div></div>

<p>To get a single table name:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tables</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT name FROM sqlite_schema WHERE type='table'"</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># length can be 0 (no table) or &gt;1 (more than one table)
</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">f"The database </span><span class="si">{</span><span class="n">db</span><span class="si">}</span><span class="s"> contains no table."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">f"The database </span><span class="si">{</span><span class="n">db</span><span class="si">}</span><span class="s"> contains more than one table: </span><span class="si">{</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span><span class="si">}</span><span class="s">."</span><span class="p">)</span>
<span class="n">table_name</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>
<p>If we are sure there is only a single table:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table_name</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT name FROM sqlite_schema WHERE type='table'"</span><span class="p">).</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>To iterate over the rows of the table <code class="language-plaintext highlighter-rouge">table_name</code>:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cur</span><span class="p">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">Row</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s">"</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s">'date'</span><span class="p">:</span> <span class="s">'2006-01-05'</span><span class="p">,</span> <span class="s">'trans'</span><span class="p">:</span> <span class="s">'BUY'</span><span class="p">,</span> <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'RHAT'</span><span class="p">,</span> <span class="s">'qty'</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span> <span class="s">'price'</span><span class="p">:</span> <span class="mf">35.14</span><span class="p">}</span>
<span class="p">{</span><span class="s">'date'</span><span class="p">:</span> <span class="s">'2006-03-28'</span><span class="p">,</span> <span class="s">'trans'</span><span class="p">:</span> <span class="s">'BUY'</span><span class="p">,</span> <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'IBM'</span><span class="p">,</span> <span class="s">'qty'</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="s">'price'</span><span class="p">:</span> <span class="mf">45.0</span><span class="p">}</span>
<span class="p">{</span><span class="s">'date'</span><span class="p">:</span> <span class="s">'2006-04-06'</span><span class="p">,</span> <span class="s">'trans'</span><span class="p">:</span> <span class="s">'SELL'</span><span class="p">,</span> <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'IBM'</span><span class="p">,</span> <span class="s">'qty'</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span> <span class="s">'price'</span><span class="p">:</span> <span class="mf">53.0</span><span class="p">}</span>
<span class="p">{</span><span class="s">'date'</span><span class="p">:</span> <span class="s">'2006-04-05'</span><span class="p">,</span> <span class="s">'trans'</span><span class="p">:</span> <span class="s">'BUY'</span><span class="p">,</span> <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'MSFT'</span><span class="p">,</span> <span class="s">'qty'</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span> <span class="s">'price'</span><span class="p">:</span> <span class="mf">72.0</span><span class="p">}</span>
</code></pre></div></div>

<p>At the end, close the connection:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

  </div><a class="u-url" href="/til/2021/10/30/sqlite3.html" hidden></a>
</article>
